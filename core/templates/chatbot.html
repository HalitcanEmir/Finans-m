{% extends 'base.html' %}

{% block title %}Yapay Zekâya Danış{% endblock %}

{% block content %}
<div id="aiChatBg" class="d-flex align-items-center justify-content-center" style="min-height:80vh;">
  <div id="chatContainer" class="shadow-lg rounded-4" style="width:100%; max-width:480px; background:rgba(30,30,47,0.98); min-height:520px; display:flex; flex-direction:column; position:relative;">
    <div id="chatHeader" class="px-4 pt-4 pb-2" style="border-radius:2rem 2rem 0 0;">
      <h2 class="fw-bold mb-0" style="color:#fff; font-size:1.35rem; letter-spacing:-1px;">🤖 Yapay Zekâya Danış</h2>
      <div style="color:#A0C1FF; font-size:0.98rem;">Finansal sorularınızı yazın, anında yanıt alın.</div>
    </div>
    <div id="chatMessages" class="flex-grow-1 px-3 py-2" style="overflow-y:auto; display:flex; flex-direction:column; gap:1.1rem;">
      {% if messages %}
        {% for msg in messages %}
          {% if msg.role == 'user' %}
            <div class="chat-bubble user-bubble fade-in">
              <span class="bubble-text">{{ msg.content }}</span>
            </div>
          {% elif msg.role == 'bot' %}
            <div class="chat-bubble bot-bubble fade-in">
              <span class="bubble-text">{{ msg.content }}</span>
            </div>
          {% endif %}
        {% endfor %}
      {% endif %}
    </div>
    <form id="chatForm" method="post" autocomplete="off" class="chat-input-form px-3 pb-3 pt-2" style="position:sticky; bottom:0; background:rgba(30,30,47,0.98); border-radius:0 0 2rem 2rem; z-index:2;">
      {% csrf_token %}
      <div class="input-group">
        <input id="userInput" type="text" name="user_input" class="form-control" placeholder="Mesajınızı yazın..." required style="background:rgba(255,255,255,0.08); color:#fff; border:none; border-radius:1.5rem; font-size:1.08rem;">
        <button id="sendBtn" class="btn btn-primary d-flex align-items-center justify-content-center ms-2" type="submit" style="border-radius:50%; width:44px; height:44px; background:#7F5AF0; border:none; transition:background 0.18s, transform 0.18s;">
          <i class="fa-solid fa-paper-plane" style="font-size:1.25rem;"></i>
        </button>
      </div>
    </form>
  </div>
</div>

<style>
  #aiChatBg {
    min-height: 100vh;
    background: linear-gradient(120deg, #1e1e2f 0%, #3a3b68 100%);
    padding: 2.5rem 0;
  }
  #chatContainer {
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.18);
    border-radius: 2rem;
    min-height: 520px;
    max-width: 480px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    background: rgba(30,30,47,0.98);
    position: relative;
  }
  #chatHeader {
    border-radius: 2rem 2rem 0 0;
    background: none;
    text-align: left;
  }
  #chatMessages {
    flex-grow: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 1.1rem;
    padding-bottom: 0.5rem;
    scroll-behavior: smooth;
  }
  .chat-bubble {
    max-width: 85%;
    padding: 0.85rem 1.2rem;
    border-radius: 1.3rem;
    font-size: 1.08rem;
    box-shadow: 0 2px 12px 0 rgba(127,90,240,0.07);
    word-break: break-word;
    opacity: 0;
    transform: translateY(24px);
    animation: fadeInBubble 0.5s forwards;
  }
  .user-bubble {
    align-self: flex-end;
    background: linear-gradient(90deg, #7F5AF0 60%, #232946 100%);
    color: #fff;
    border-bottom-right-radius: 0.5rem;
    box-shadow: 0 2px 12px 0 rgba(127,90,240,0.13);
  }
  .bot-bubble {
    align-self: flex-start;
    background: #f5f5fa;
    color: #232136;
    border-bottom-left-radius: 0.5rem;
    box-shadow: 0 2px 12px 0 rgba(160,193,255,0.10);
  }
  .bubble-text {
    font-family: 'Inter', 'Poppins', 'Roboto', Arial, sans-serif;
    font-size: 1.08rem;
    line-height: 1.5;
  }
  .fade-in {
    opacity: 1 !important;
    transform: translateY(0) !important;
    transition: opacity 0.4s, transform 0.4s;
  }
  #chatForm {
    position: sticky;
    bottom: 0;
    background: rgba(30,30,47,0.98);
    border-radius: 0 0 2rem 2rem;
    z-index: 2;
    margin-top: auto;
  }
  #userInput:focus {
    outline: none;
    box-shadow: 0 0 0 2px #7F5AF033;
  }
  #sendBtn:hover, #sendBtn:focus {
    background: #A0C1FF;
    color: #232136;
    transform: scale(1.13);
  }
  @media (max-width: 600px) {
    #chatContainer {
      max-width: 100vw;
      min-height: 100vh;
      border-radius: 0;
      box-shadow: none;
    }
    #aiChatBg {
      padding: 0;
    }
    #chatHeader {
      padding-left: 1rem;
      padding-right: 1rem;
    }
    #chatMessages {
      padding-left: 0.5rem;
      padding-right: 0.5rem;
    }
    #chatForm {
      padding-left: 0.5rem;
      padding-right: 0.5rem;
      border-radius: 0 0 1.2rem 1.2rem;
    }
  }
</style>

<script>
function scrollToBottom() {
  const chatMessages = document.getElementById('chatMessages');
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

document.addEventListener('DOMContentLoaded', function () {
  setTimeout(() => {
    document.getElementById('chatContainer').classList.add('fade-in');
    scrollToBottom();
  }, 180);
  const chatForm = document.getElementById('chatForm');
  const userInput = document.getElementById('userInput');
  chatForm.addEventListener('submit', function (e) {
    setTimeout(() => {
      userInput.value = '';
      scrollToBottom();
    }, 120);
  });
  const observer = new MutationObserver(scrollToBottom);
  observer.observe(document.getElementById('chatMessages'), { childList: true });
});
</script>
{% endblock %} 